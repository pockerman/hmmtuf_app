{% extends "base.html" %}
{% block title %}HMMtuf-Multi View Viterbi Path{% endblock title %}
{%block inner_body %}
{% load static %}


<br/>

{% if show_get_results_button %}

<div class="row">
    <div class="col-lg-8 mb-4">
            <h4>Viterbi path calculation task submitted</h4>
            <h5>Task id: {{ task_id }}</h5>
            <h5>Computation  status: {{ task_status }}</h5>

        <a href="/compute/view_multi_viterbi_path/{{ task_id }}" class="btn btn-primary">Get Results</a>
    </div>

</div>
{% elif  error_task_failed %}
<div class="row">
    <div class="col-lg-8 mb-4">
        <h4>Viterbi path calculation task FAILED</h4>
        <h5>Task id: {{ task_id }}</h5>
        <h5>ERROR: Task {{ task_id }} failed</h5>
        <h5>MESSAGE: {{ computation.error_explanation }}</h5>
    </div>
</div>
{% else %}
<div class="row">

    <h3>Task data</h3>
    <hr/>
    <div class="col-lg-12 float-left">
    <ul>
        <li>HMM filename: {{ computation.hmm_filename }} </li>
        <li>Chromosome: {{ computation.chromosome }}</li>
        <li>Number of regions: {{ computation.n_regions }}</li>
    </ul>
    </div>
</div>

<div class="row">
    <h3>HMM Model</h3>
    <hr/>
    <img src="{{ computation.hmm_path_img }}" width="700"/>
</div>

<!--hide me-->
<div class="row">
    <h3>Windows labels</h3>
    <hr/>
    <!--<img src="{{ viterbi_label_plot_filename }}" width="500"/>-->
    <svg id="canvas" width="800" height="500"></svg>
</div>

<br/>

<div class="col-lg-12" id="igv-browser">
</div>
<script src="https://cdn.jsdelivr.net/npm/igv@2.6.2/dist/igv.min.js"></script>
<script>
var igvDiv = document.getElementById("igv-browser");
var options =
        {
            genome: "hg38",
            locus: "chr8:127,736,588-127,739,371",
            tracks: [
                {
                    "name": "HG00103",
                    "url": "https://s3.amazonaws.com/1000genomes/data/HG00103/alignment/HG00103.alt_bwamem_GRCh38DH.20150718.GBR.low_coverage.cram",
                    "indexURL": "https://s3.amazonaws.com/1000genomes/data/HG00103/alignment/HG00103.alt_bwamem_GRCh38DH.20150718.GBR.low_coverage.cram.crai",
                    "format": "cram"
                }
            ]
        };

igv.createBrowser(igvDiv, options)
                .then(function (browser) {
                    console.log("Created IGV browser");
                })
</script>

<script>
    var svg = d3.select("#canvas");
</script>
{% endif %}
{% endblock inner_body %}